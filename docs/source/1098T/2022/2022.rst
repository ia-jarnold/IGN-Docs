=====================
2022 1098t Procedures
=====================

2022 1098t Procedure 0
======================

| Verify the institution info in ORGP/AORG/PID2 I have found it is mostly the same and correct :orangebold:`there are two entries in ORGP`.

* ORGP/AORG/PID2
* `1098t Ellucian Walkthrough`_

2022 1098t Procedure 1
======================

| Consider printing options if supplying students with there own physical pdfs not the ones provied by the colleague ui to download, these will be turned on for student to collect after the IRS.

* T9TF

2022 1098t Procedure 2
======================

| Backup last years data locally.

.. dropdown:: 1098t Backup

   .. code-block:: SQL

      -- last years backups
      SELECT *
      FROM ltcc.dbo.AR_1098T_BOXES_WORK_2020

      SELECT *
      FROM ltcc.dbo.AR_1098T_WORK_2020


      SELECT *
      INTO ltcc.dbo.AR_1098T_BOXES_WORK_2021
      FROM coll18_production.dbo.AR_1098T_BOXES_WORK


      SELECT *
      INTO ltcc.dbo.AR_1098T_WORK_2021
      FROM coll18_production.dbo.AR_1098T_WORK

2022 1098t Procedure 3
======================

| Verify Status and Purge the workfiles

* T9TC for status. Status should be unfrozen for purge.
* T9TP for purge. We do not purge the tax year repo but change purge to Y.

2022 1098t Procedure 4
======================

| Check out the CORE VAL codes tabel TAX.FORMS.

| Review the 1098t box codes TFBX. This term I ensured the 1098t boxes still map roughly to the explanations in  `2023 1098t Instructions`_ . They look correct.

| Review AR codes...ARCT...it appears to map ltcc fee waivers to box 2 for calculation. This term Michael and I were looking at the new loan awards also. I found that they may be reported in 1098-E. But may ask TRA this when we start to submit.


2022 1098t Procedure 5
======================

| Set up or review the defaults and parameters used for 1098-T reporting using the 1098-T Defaults/Parameters (T9TD) form. See `1098t Ellucian Walkthrough`_ for more information.

| Change the Tax Year to the the current in 2023 it is tax year 2022.

.. image:: /_static/img/1098T/T9TD.png
   :alt: 1098T Folder
   :align: center

| :orangebold:`Update the years appropriately in the enroll dates aka plus 1 I am currently not sure of the specifics here but it does match what dave did historically. Also note the field help mentions that this defines the dates a student must be enrolled to receive a 1098t which is also what the savelist determines`


|  :orangebold:`This year we will will be providing the students with 1098t's through webadvisor. After they have been submitted to the IRS. This may require corrections to be made in colleague this year.` This will involve steps in T9TY.

| :orangebold:`Adding a webadvisor pdf will require information in the 3 consent fields on T9TD`


2022 1098t Procedure 6
======================

| Run T9TG with the following savelist named 1098T_2022.

.. dropdown:: T9TG Savelist
   :color: warning

   | Cauptures any student that has made a payment, received a payment, or Enrolled thre terms prior to report start term.

   .. code-block:: sql

      SELECT
      DISTINCT
      LEFT(FA.TA_2022_ID,7)  ID
      FROM [coll18_production].[dbo].[TA_2022] FA
      WHERE YEAR(FA.TA_TERM_XMIT_DT) = '2022' and (TA_TERM_XMIT_AMT IS NOT NULL or TA_TERM_XMIT_AMT > 0)

      UNION

      SELECT
      DISTINCT
      PYMT.ARP_PERSON_ID  ID
      FROM
      AR_PAYMENTS PYMT

      WHERE
      YEAR(PYMT.ARP_DATE) ='2022' and (ARP_AMT IS NOT NULL or ARP_AMT > 0 )

      UNION
      SELECT
      DISTINCT
      STC.STC_PERSON_ID   ID
      FROM STUDENT_ACAD_CRED STC
      WHERE STC.STC_TERM IN ('2021FA', '2022WI', '2022SP', '2022SU', '2022FA' , '2023WI' , '2023SP')

| Save the ssn and address errors for reference.

2022 1098t Procedure 7
======================

| Run T9TR to generate the detail report. witha save list derived from the Work table.
| This report will show the break down of ar codes and how they are calculated in each box.

2022 1098t Procedure 8
======================

| Run T9TA to generate the analytics report with a savelist derived from the work table..

.. dropdown:: Students with no Box info SQL
   :color: info

   .. code-block:: SQL

      SELECT * -- DISTINCT LEFT(aw.AR_1098T_WORK_ID, 7)
      FROM AR_1098T_WORK aw
           LEFT JOIN AR_1098T_BOXES_WORK abw ON LEFT(aw.AR_1098T_WORK_ID, 7) = LEFT(abw.AR_1098T_BOXES_WORK_ID, 7)
      WHERE LEFT(abw.AR_1098T_BOXES_WORK_ID, 7) IS NULL
            -- cross reference ennrol
            /***AND EXISTS (
                SELECT *
                FROM STUDENT_ACAD_CRED sac
                     INNER JOIN STC_STATUSES ss        ON ss.STUDENT_ACAD_CRED_ID = sac.STUDENT_ACAD_CRED_ID
                                                          AND ss.POS = 1
                     INNER JOIN STUDENT_COURSE_SEC scs ON scs.SCS_STUDENT_ACAD_CRED = sac.STUDENT_ACAD_CRED_ID
                     INNER JOIN COURSE_SECTIONS cs     ON scs.SCS_COURSE_SECTION = cs.COURSE_SECTIONS_ID
                     INNER JOIN COURSES c              ON sac.STC_COURSE = c.COURSES_ID
                WHERE cs.SEC_TERM IN ('2022WI', '2022SP', '2022SU', '2022FA')
                      AND sac.STC_PERSON_ID = LEFT(aw.AR_1098T_WORK_ID, 7)
                      AND (ss.STC_STATUS IN ('A','NR') OR sac.STC_VERIFIED_GRADE IN ('13', '56'))
            )***/

.. dropdown:: Students with empty box info SQL
   :color: info

   .. code-block:: SQL

      SELECT * --DISTINCT LEFT(aw.AR_1098T_WORK_ID, 7)
      FROM AR_1098T_WORK aw
           --INNER JOIN AR_1098T_BOXES_WORK abw ON LEFT(aw.AR_1098T_WORK_ID, 7) = LEFT(abw.AR_1098T_BOXES_WORK_ID, 7)
      WHERE NOT EXISTS (

          SELECT *
          FROM AR_1098T_BOXES_WORK abw
          WHERE LEFT(aw.AR_1098T_WORK_ID, 7) = LEFT(abw.AR_1098T_BOXES_WORK_ID, 7)
                AND (RIGHT(abw.AR_1098T_BOXES_WORK_ID, 3) = 'SCH'
                     OR RIGHT(abw.AR_1098T_BOXES_WORK_ID, 3) = 'TUP'
                     OR  RIGHT(abw.AR_1098T_BOXES_WORK_ID, 3) = 'PYA')
      ) AND EXISTS (

          SELECT *
          FROM AR_1098T_BOXES_WORK abw
          WHERE LEFT(aw.AR_1098T_WORK_ID, 7) = LEFT(abw.AR_1098T_BOXES_WORK_ID, 7)
                AND RIGHT(abw.AR_1098T_BOXES_WORK_ID, 3) = 'LOD'
                AND (
                     (abw.T98TB_VALUE = 'X' AND abw.T98TB_CALC_VALUE = 'X') -- two subsets of LOD in empty boxes.
                     OR
                     (abw.T98TB_VALUE IS NULL AND abw.T98TB_CALC_VALUE IS NULL)
                    )
      ) /***AND EXISTS (
                SELECT *
                FROM STUDENT_ACAD_CRED sac
                     INNER JOIN STC_STATUSES ss        ON ss.STUDENT_ACAD_CRED_ID = sac.STUDENT_ACAD_CRED_ID
                                                          AND ss.POS = 1
                     INNER JOIN STUDENT_COURSE_SEC scs ON scs.SCS_STUDENT_ACAD_CRED = sac.STUDENT_ACAD_CRED_ID
                     INNER JOIN COURSE_SECTIONS cs     ON scs.SCS_COURSE_SECTION = cs.COURSE_SECTIONS_ID
                     INNER JOIN COURSES c              ON sac.STC_COURSE = c.COURSES_ID
                WHERE cs.SEC_TERM IN ('2022WI', '2022SP', '2022SU', '2022FA')
                      AND sac.STC_PERSON_ID = LEFT(aw.AR_1098T_WORK_ID, 7)
                      AND (ss.STC_STATUS IN ('A','NR') OR sac.STC_VERIFIED_GRADE IN ('13', '56'))
            )***/

2022 1098t Procedure 9
======================

| Cross referenced the no box/empty box info with the no ssn and not much corelation 47 or so...

| :greenbold:`These are the break downs for the odd records in T9TA missing or no real box info reccords`

| Empty box info shows that either the enrollment was outside of the reporting year(>=2023WI) or in the reporting year with with QTRE carryover >= to QTRE.

| No box info regardless of X/NULL in LOD have QTRE carryover >= QTRE. Also most do not have a detail report entry.


2022 1098t Procedure 10
=======================

| Can verify individual combos with the T9TR/T9TA reports. Most of the time the QTRE vs QTRE carryover is the determining factor.

.. dropdown:: Combinations of Boxes SQL
   :color: info

   .. code-block:: SQL

      SELECT
      LEFT(W.AR_1098T_WORK_ID, 7) ID, W.T98T_STUDENT_NAME NAME,
      SUM(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'TUP' THEN B.T98TB_AMT ELSE 0.0 END) TUP,
      SUM(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'PYS' THEN B.T98TB_AMT ELSE 0.0 END) PYS,
      SUM(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'PYA' THEN B.T98TB_AMT ELSE 0.0 END) PYA,
      SUM(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'SCH' THEN B.T98TB_AMT ELSE 0.0 END) SCH,
      SUM(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'LOD' THEN B.T98TB_AMT ELSE 0.0 END) LOD,
      SUM(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'GSB' THEN B.T98TB_AMT ELSE 0.0 END) GSB,
      SUM(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'TJM' THEN B.T98TB_AMT ELSE 0.0 END) TJM,
      SUM(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'SSC' THEN B.T98TB_AMT ELSE 0.0 END) SSC,
      MAX(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'TUP' AND B.T98TB_AMT > 0 THEN 'Y' END) TUP_FLAG,
      MAX(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'PYS' AND B.T98TB_AMT > 0 THEN 'Y' END) PYS_FLAG,
      MAX(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'PYA' AND B.T98TB_AMT > 0 THEN 'Y' END) PYA_FLAG,
      MAX(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'SCH' AND B.T98TB_AMT > 0 THEN 'Y' END) SCH_FLAG,
      MAX(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'LOD' AND B.T98TB_AMT > 0 THEN 'Y' END) LOD_FLAG,
      MAX(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'GSB' AND B.T98TB_AMT > 0 THEN 'Y' END) GSB_FLAG,
      MAX(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'TJM' AND B.T98TB_AMT > 0 THEN 'Y' END) TJM_FLAG,
      MAX(CASE WHEN RIGHT(B.AR_1098T_BOXES_WORK_ID, 3) = 'SSC' AND B.T98TB_AMT > 0 THEN 'Y' END) SSC_FLAG,
      NEWID() RANDOM_ID


      INTO #RAWDATA

      FROM AR_1098T_WORK W INNER JOIN
      AR_1098T_BOXES_WORK B ON LEFT(W.AR_1098T_WORK_ID, 7) = LEFT(B.AR_1098T_BOXES_WORK_ID, 7)

      GROUP BY LEFT(W.AR_1098T_WORK_ID, 7), W.T98T_STUDENT_NAME

      SELECT
      RD.ID,
      RD.NAME,
      RD.TUP,
      RD.PYS,
      RD.PYA,
      RD.SCH,
      RD.LOD,
      RD.GSB,
      RD.TJM,
      RD.SSC,
      W.T98T_QTRE,
      W.T98T_QTRE_CARRYOVER


      FROM
      #RAWDATA RD INNER JOIN
      (
      SELECT TUP_FLAG, PYS_FLAG, PYA_FLAG, SCH_FLAG, LOD_FLAG, GSB_FLAG, TJM_FLAG, SSC_FLAG, CAST(MAX(CAST(RANDOM_ID AS VARCHAR(MAX))) AS UNIQUEIDENTIFIER) SELECTED_RECORD
      FROM #RAWDATA
      GROUP BY TUP_FLAG, PYS_FLAG, PYA_FLAG, SCH_FLAG, LOD_FLAG, GSB_FLAG, TJM_FLAG, SSC_FLAG
      ) RANDOM_SAMPLE ON RD.RANDOM_ID = RANDOM_SAMPLE.SELECTED_RECORD
      INNER JOIN  AR_1098T_WORK W ON RD.ID = LEFT(W.AR_1098T_WORK_ID, 7)
      ORDER BY
      RD.TUP,
      RD.PYS,
      RD.SCH,
      RD.PYA,
      RD.LOD,
      RD.GSB,
      RD.TJM,
      RD.SSC

      DROP TABLE #RAWDATA


2022 1098t Procedure 11
=======================

* Use T9TC to Freeze the work file for export.

2022 1098t Procedure 12
=======================

| This year I tested with the savelist to export with a savelist built from the queries in :ref:`2022 1098t Procedure 8` these at least have no box info.

.. dropdown:: 1098t Export Savelist SQL
   :color: info

   .. code-block:: SQL

      SELECT *
      FROM AR_1098T_WORK awf
      WHERE awf.AR_1098T_WORK_ID NOT IN ( -- missing box info

            SELECT DISTINCT aw.AR_1098T_WORK_ID
            FROM AR_1098T_WORK aw
                 LEFT JOIN AR_1098T_BOXES_WORK abw ON LEFT(aw.AR_1098T_WORK_ID, 7) = LEFT(abw.AR_1098T_BOXES_WORK_ID, 7)
            WHERE LEFT(abw.AR_1098T_BOXES_WORK_ID, 7) IS NULL

      ) AND awf.AR_1098T_WORK_ID NOT IN ( -- No Box info...

            SELECT DISTINCT aw.AR_1098T_WORK_ID
            FROM AR_1098T_WORK aw
                 INNER JOIN AR_1098T_BOXES_WORK abw ON LEFT(aw.AR_1098T_WORK_ID, 7) = LEFT(abw.AR_1098T_BOXES_WORK_ID, 7)

            WHERE NOT EXISTS (

                  SELECT *
                  FROM AR_1098T_BOXES_WORK abw
                  WHERE LEFT(aw.AR_1098T_WORK_ID, 7) = LEFT(abw.AR_1098T_BOXES_WORK_ID, 7)
                        AND (
                             RIGHT(abw.AR_1098T_BOXES_WORK_ID, 3) = 'SCH'
                             OR RIGHT(abw.AR_1098T_BOXES_WORK_ID, 3) = 'TUP'
                             OR RIGHT(abw.AR_1098T_BOXES_WORK_ID, 3) = 'PYA'
                             OR RIGHT(abw.AR_1098T_BOXES_WORK_ID, 3) = 'PYS'
                        )

                  ) AND EXISTS (

                    SELECT *
                    FROM AR_1098T_BOXES_WORK abw
                    WHERE LEFT(aw.AR_1098T_WORK_ID, 7) = LEFT(abw.AR_1098T_BOXES_WORK_ID, 7)
                          AND RIGHT(abw.AR_1098T_BOXES_WORK_ID, 3) = 'LOD'
                          AND (
                                (abw.T98TB_VALUE = 'X' AND abw.T98TB_CALC_VALUE = 'X') -- two subsets of LOD in empty boxes.
                                OR
                                (abw.T98TB_VALUE IS NULL AND abw.T98TB_CALC_VALUE IS NULL)
                          )
                  )
      )


| This removed ~550 or so records from the final submission. The actual export seemed to remove another 20 more or so more. All of witch had QTRE <= QTRE Carryover. This told me that there is already an internal definition being applied. I re-ran the export with no savelist and indeed we receive the same record count...

| :greenbold:`TLDR...Colleague removes the bad records from the work file on export automatically based on QTRE seemingly. The files are literally identical in size.`

* The export files end up in \\ltcc-app\apphome\FINANCIAL.EXPORTS\T9TM_..._... and are archived in Standard IE Procedures\1098T\Media_Files\...


2022 1098t Procedure 13
=======================

| Reach out to TRA initially to have them change our submission status to test for the initial submission.












